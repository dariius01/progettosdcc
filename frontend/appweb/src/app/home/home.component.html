<div class="container">
  <div class="auth-links">
    <button *ngIf="!isLoggedIn" routerLink="/login" class="btn-auth">Accedi</button>
    <button *ngIf="!isLoggedIn" routerLink="/register" class="btn-auth">Registrati</button>
    <button *ngIf="isLoggedIn" (click)="logout()" class="btn-auth">Logout</button>
  </div>

  <h1 class="titolo">Ricerca Notizie</h1>

  <!-- Barra di ricerca con icona lente -->
  <div class="barra-ricerca">
    <mat-icon class="icona-lente">search</mat-icon>
    <input
      type="text"
      [(ngModel)]="query"
      (keydown.enter)="cerca()"
      placeholder="Cerca notizie"
      class="input-elegante"
    />
  </div>

  <!-- Bottone aggiungi manualmente -->
  <div class="azioni-manuali" style="margin: 10px 0;">
    <button (click)="vaiAdAggiuntaManuale()" class="btn-manuale">
      Aggiungi manualmente
    </button>

    <button *ngIf="articoliManuali.length > 0" (click)="toggleMostraArticoliManuali()" class="btn-manuale">
      {{ mostraArticoliManuali ? 'Nascondi articoli aggiunti' : 'Mostra articoli aggiunti' }}
    </button>
  </div>

  <!-- Lista articoli manuali aggiunti -->
  <div *ngIf="mostraArticoliManuali" class="lista-articoli-manuali">
    <ul>
      <li
        *ngFor="let articolo of articoliManuali"
        [class.selezionato]="articoloManualeSelezionato === articolo"
        style="cursor:pointer; padding: 5px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;"
        (click)="selezionaArticoloManuale(articolo)"
      >
        <span>{{ articolo.titolo }}</span>
        <!-- Cestino per rimuovere articolo -->
        <button
          class="btn-cestino"
          (click)="rimuoviArticoloManuale(articolo, $event)"
          aria-label="Elimina articolo"
          title="Elimina articolo"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </li>
    </ul>

    <div *ngIf="articoloManualeSelezionato" class="dettaglio-articolo-manuale" style="margin-top: 10px; padding: 10px; border: 1px solid #ccc;">
      <h3>{{ articoloManualeSelezionato.titolo }}</h3>
      <h4 *ngIf="articoloManualeSelezionato.sottotitolo"><em>{{ articoloManualeSelezionato.sottotitolo }}</em></h4>
      <p>{{ articoloManualeSelezionato.testo }}</p>
    </div>
  </div>

  <!-- Messaggio di errore -->
  <div *ngIf="errore" class="messaggio-errore">{{ errore }}</div>




  <div class="lista-risultati">
  <div
    *ngFor="let notizia of risultati"
    class="card-notizia"
    [class.selezionata]="isSelezionata(notizia)"
  >
    <!-- Checkbox di selezione -->
    <label class="check-container">
      <input
        type="checkbox"
        [checked]="isSelezionata(notizia)"
        (change)="toggleSelezione(notizia, $event)"
      />
      <span class="custom-check"></span>
    </label>

    <!-- Contenuto notizia -->
    <div class="contenuto-notizia">
      <h3>
        <a
          *ngIf="notizia.url"
          [href]="notizia.url"
          target="_blank"
          rel="noopener noreferrer"
          class="titolo-notizia-link"
        >
          {{ notizia.titolo }}
        </a>
        <span *ngIf="!notizia.url">{{ notizia.titolo }}</span>
      </h3>

      <p *ngIf="notizia.sottotitolo"><em>{{ notizia.sottotitolo }}</em></p>
      <p *ngIf="notizia.source" class="fonte">Fonte: {{ notizia.source }}</p>
    </div>
  </div>
</div>




<!-- Area generazione articolo (mostrata se ci sono risultati o articoli manuali) -->
<div class="area-generazione" *ngIf="(risultati.length > 0) || (articoliManuali.length > 0)">
  <button
    (click)="generaNotizia()"
    [disabled]="loadingGenerazione || (notizieSelezionate.length === 0 && articoliManuali.length === 0)"
    [class.attivo]="notizieSelezionate.length > 0 || articoliManuali.length > 0"
  >
    {{ loadingGenerazione ? 'Generazione in corso...' : 'Genera Articolo' }}
  </button>

  <div *ngIf="erroreGenerazione" class="messaggio-errore">
    {{ erroreGenerazione }}
  </div>
</div>

<!-- Icona orologio per mostrare/nascondere cronologia (solo se loggato) -->
<div *ngIf="isLoggedIn" class="cronologia-icon-container">
  <mat-icon (click)="toggleCronologia()" class="cronologia-icon">access_time</mat-icon>
</div>

<!-- Colonna laterale della cronologia -->
<div *ngIf="mostraCronologia" class="lista-cronologia">
  <h3>Ultime notizie generate</h3>
  <ul>
    <li *ngFor="let notizia of cronologiaNotizie" class="item-cronologia">
      <a *ngIf="notizia.id" [routerLink]="['/notizia', notizia.id]" class="titolo-cronologia-link">
        {{ notizia.titolo }}
      </a>
    </li>
  </ul>

  <p *ngIf="cronologiaNotizie.length === 0">Nessuna notizia in cronologia.</p>
</div> 